<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>5 Â§©ÂÄíËÆ°Êó∂</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    html,body{height:100%}
    body{
      min-height:100vh;
      display:flex;justify-content:center;align-items:center;
      background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
      color:#fff;font-family:'Poppins',system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
      -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;
      padding:20px;
    }
    .container{
      width:100%;
      max-width:900px;
      text-align:center;
      background:rgba(255,255,255,.06);
      padding:36px;border-radius:14px;
      box-shadow:0 8px 30px rgba(0,0,0,.5);
      backdrop-filter:blur(8px)
    }
    h1{font-size:2rem;margin-bottom:18px;letter-spacing:1px}
    .countdown{display:flex;justify-content:center;gap:18px;font-size:1.6rem;flex-wrap:wrap}
    .time-box{
      background:rgba(255,255,255,.08);
      padding:12px 20px;border-radius:10px;text-align:center;transition:transform .18s,background .18s;
      min-width:88px;
    }
    .time-box:focus-within{outline:2px solid rgba(255,255,255,.12)}
    .time-box:hover{background:rgba(255,255,255,.12);transform:translateY(-4px)}
    .value{font-weight:700;font-variant-numeric:tabular-nums;font-size:1.6rem}
    .label{font-size:.75rem;color:#dcdcdc;margin-top:6px;text-transform:uppercase;letter-spacing:1px}
    .progress-wrapper{
      width:100%;height:12px;background:rgba(255,255,255,.08);
      border-radius:999px;margin-top:22px;overflow:hidden
    }
    #progress{
      height:100%;background:linear-gradient(90deg,#7be7ff,#ffd36e);border-radius:999px;
      width:0%;transition:width .18s linear
    }
    .controls{margin-top:16px;display:flex;gap:10px;justify-content:center;align-items:center;flex-wrap:wrap}
    button{
      background:rgba(255,255,255,.08);border:0;color:#fff;padding:8px 12px;border-radius:8px;cursor:pointer;
      transition:background .15s,transform .12s;
    }
    button:hover{background:rgba(255,255,255,.14);transform:translateY(-2px)}
    button:active{transform:translateY(0)}
    button:focus{outline:2px solid rgba(255,255,255,.12)}
    .meta{margin-top:8px;color:#d7e6ef;font-size:.86rem;opacity:.9}
    @media (prefers-reduced-motion:reduce){
      .time-box,.value,#progress,button{transition:none;animation:none}
    }
  </style>
</head>
<body>
  <div class="container" id="countdown-root"
       aria-label="ÂÄíËÆ°Êó∂ÂÆπÂô®"
       data-duration-days="5">
    <h1 id="title">5 Â§©ÂÄíËÆ°Êó∂</h1>

    <div class="countdown" role="group" aria-label="ÂÄíËÆ°Êó∂Êó∂Èó¥">
      <div class="time-box" tabindex="0" aria-hidden="false">
        <div id="days" class="value" aria-live="off">00</div>
        <div class="label">Â§©</div>
      </div>

      <div class="time-box" tabindex="0" aria-hidden="false">
        <div id="hours" class="value">00</div>
        <div class="label">Êó∂</div>
      </div>

      <div class="time-box" tabindex="0" aria-hidden="false">
        <div id="minutes" class="value">00</div>
        <div class="label">ÂàÜ</div>
      </div>

      <div class="time-box" tabindex="0" aria-hidden="false">
        <div id="seconds" class="value">00</div>
        <div class="label">Áßí</div>
      </div>
    </div>

    <div class="progress-wrapper" aria-hidden="false" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" aria-label="ÂÄíËÆ°Êó∂ËøõÂ∫¶">
      <div id="progress"></div>
    </div>

    <div class="controls" aria-hidden="false">
      <button id="pauseBtn" type="button" aria-pressed="false">ÊöÇÂÅú</button>
      <button id="resetBtn" type="button">ÈáçÁΩÆ</button>
    </div>

    <div class="meta" id="meta" aria-live="polite"></div>
  </div>

  <script>
    (function () {
      // Elements
      const root = document.getElementById('countdown-root');
      const daysEl = document.getElementById('days');
      const hoursEl = document.getElementById('hours');
      const minutesEl = document.getElementById('minutes');
      const secondsEl = document.getElementById('seconds');
      const progressEl = document.getElementById('progress');
      const progressWrapper = document.querySelector('.progress-wrapper');
      const pauseBtn = document.getElementById('pauseBtn');
      const resetBtn = document.getElementById('resetBtn');
      const meta = document.getElementById('meta');
      const title = document.getElementById('title');

      // Config: either data-target (ISO datetime) or data-duration-days (number)
      const targetAttr = root.getAttribute('data-target'); // ISO string optional
      const durationDaysAttr = parseFloat(root.getAttribute('data-duration-days') || '5');
      const DURATION_MS = (isFinite(durationDaysAttr) && durationDaysAttr > 0)
        ? Math.round(durationDaysAttr * 24 * 60 * 60 * 1000)
        : 5 * 24 * 60 * 60 * 1000;

      // If data-target provided and valid, use that (absolute)
      let TARGET = null;
      if (targetAttr) {
        const t = new Date(targetAttr);
        if (!isNaN(t)) TARGET = t;
      }
      // Otherwise target = now + DURATION_MS.
      const initialStart = new Date();
      if (!TARGET) TARGET = new Date(initialStart.getTime() + DURATION_MS);

      // State for pause/resume handling
      let pausedAt = null;    // timestamp when paused (ms)
      let pausedAccum = 0;    // accumulated paused ms
      let finished = false;

      const TOTAL = TARGET - initialStart; // constant total duration (ms)

      // Utility: format number with leading zeros, allow more than 2 digits for days
      function pad(n, minLen = 2) {
        const s = String(n);
        return s.length >= minLen ? s : s.padStart(minLen, '0');
      }

      // Update UI; use effectiveNow = now - pausedAccum
      function update(nowMs) {
        if (finished) return;
        const now = new Date(nowMs);
        const effectiveNowMs = nowMs - pausedAccum;
        const diff = TARGET.getTime() - effectiveNowMs;

        if (diff <= 0) {
          finished = true;
          daysEl.textContent = '00';
          hoursEl.textContent = '00';
          minutesEl.textContent = '00';
          secondsEl.textContent = '00';
          progressEl.style.width = '100%';
          progressWrapper.setAttribute('aria-valuenow', '100');
          meta.textContent = 'ÂÄíËÆ°Êó∂ÁªìÊùü üéâ';
          title.textContent = 'ÂÄíËÆ°Êó∂ÁªìÊùü';
          return;
        }

        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
        const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
        const minutes = Math.floor((diff / (1000 * 60)) % 60);
        const seconds = Math.floor((diff / 1000) % 60);

        // Update numbers
        daysEl.textContent = pad(days, 2);
        hoursEl.textContent = pad(hours, 2);
        minutesEl.textContent = pad(minutes, 2);
        secondsEl.textContent = pad(seconds, 2);

        // progress percent = elapsed / TOTAL
        const elapsed = TOTAL - diff;
        const percent = Math.max(0, Math.min(100, (elapsed / TOTAL) * 100));
        progressEl.style.width = percent.toFixed(2) + '%';
        progressWrapper.setAttribute('aria-valuenow', String(Math.round(percent)));

        // Friendly meta text for screen readers / small hint
        meta.textContent = `Ââ©‰Ωô ${days} Â§© ${hours} Â∞èÊó∂ ${minutes} ÂàÜ ${seconds} Áßí`;
      }

      // Animation loop: use requestAnimationFrame but throttle to ~200ms for efficiency.
      let rafId = null;
      let lastTick = 0;
      const MIN_TICK_MS = 200;

      function loop(timestamp) {
        if (!lastTick || (timestamp - lastTick) >= MIN_TICK_MS) {
          update(timestamp);
          lastTick = timestamp;
        }
        if (!finished && !pausedAt) {
          rafId = requestAnimationFrame(loop);
        } else {
          rafId = null;
        }
      }

      // Start the loop
      rafId = requestAnimationFrame(loop);

      // Pause/resume button handlers
      function setPaused(paused) {
        if (paused === Boolean(pausedAt)) return;
        if (paused) {
          pausedAt = Date.now();
          pauseBtn.textContent = 'ÁªßÁª≠';
          pauseBtn.setAttribute('aria-pressed', 'true');
          meta.textContent = 'Â∑≤ÊöÇÂÅú';
          // stop the rAF loop
          if (rafId) { cancelAnimationFrame(rafId); rafId = null; }
        } else {
          // accumulate paused time
          if (pausedAt) {
            pausedAccum += Date.now() - pausedAt;
          }
          pausedAt = null;
          pauseBtn.textContent = 'ÊöÇÂÅú';
          pauseBtn.setAttribute('aria-pressed', 'false');
          meta.textContent = 'ÁªßÁª≠‰∏≠‚Ä¶';
          lastTick = 0;
          if (!finished && !rafId) rafId = requestAnimationFrame(loop);
        }
      }

      pauseBtn.addEventListener('click', function () {
        setPaused(!pausedAt);
      });

      // Allow keyboard: Space/Enter toggles when focused
      pauseBtn.addEventListener('keydown', function (e) {
        if (e.key === ' ' || e.key === 'Enter') {
          e.preventDefault();
          setPaused(!pausedAt);
        }
      });

      // Reset button: resets to original now + duration (restarts countdown)
      resetBtn.addEventListener('click', function () {
        // Recompute baseline: new start = now
        const now = new Date();
        // If original target came from data-target (absolute), keep using it;
        // otherwise set new target to now + DURATION_MS
        if (!targetAttr) {
          TARGET = new Date(now.getTime() + DURATION_MS);
        } else {
          // If targetAttr was absolute and already passed, keep as-is (end immediately).
          const t = new Date(targetAttr);
          if (!isNaN(t)) TARGET = t;
        }

        // reset internal state
        pausedAt = null;
        pausedAccum = 0;
        finished = false;
        pauseBtn.textContent = 'ÊöÇÂÅú';
        pauseBtn.setAttribute('aria-pressed', 'false');
        meta.textContent = 'Â∑≤ÈáçÁΩÆ';
        lastTick = 0;
        if (!rafId) rafId = requestAnimationFrame(loop);
      });

      // Initialize meta + accessible timer role
      const timerRegion = document.createElement('div');
      timerRegion.setAttribute('role', 'status');
      timerRegion.setAttribute('aria-live', 'polite');
      timerRegion.style.position = 'absolute';
      timerRegion.style.left = '-9999px';
      timerRegion.style.width = '1px';
      timerRegion.style.height = '1px';
      timerRegion.id = 'sr-timer';
      document.body.appendChild(timerRegion);

      // Periodically update SR region (every second)
      setInterval(() => {
        if (finished) {
          timerRegion.textContent = 'ÂÄíËÆ°Êó∂Â∑≤ÁªìÊùü';
        } else if (pausedAt) {
          timerRegion.textContent = 'ÂÄíËÆ°Êó∂Â∑≤ÊöÇÂÅú';
        } else {
          const now = Date.now();
          const effectiveNow = now - pausedAccum;
          const diff = Math.max(0, TARGET.getTime() - effectiveNow);
          const d = Math.floor(diff / (1000 * 60 * 60 * 24));
          const h = Math.floor((diff / (1000 * 60 * 60)) % 24);
          const m = Math.floor((diff / (1000 * 60)) % 60);
          const s = Math.floor((diff / 1000) % 60);
          timerRegion.textContent = `Ââ©‰Ωô ${d} Â§© ${h} Â∞èÊó∂ ${m} ÂàÜ ${s} Áßí`;
        }
      }, 1000);

      // Initial single update
      update(Date.now());
    })();
  </script>
</body>
</html>
